// Copyright Zikula Foundation 2010 - license GNU/LGPLv3 (or at your option, any later version).
document.observe("dom:loaded",function(){var b={headerSelector:"strong",headerClassName:"z-systemnoticeheader z-panel-indicator",effectDuration:0.5};if($("z-securityanalyzer")){b.active=[0]}new Zikula.UI.Panels("admin-systemnotices",b);var a=$$("#z-developernotices ul:first");if(a[0]){a[0].removeClassName("z-hide")}});Event.observe(window,"load",function(){context_menu=Array();editors=Array();droppables=Array();make_tabs_sortable=function(){Sortable.create("admintabs",{tag:"li",constraint:"horizontal",onChange:function(f){$$("#"+f.id+" a").each(function(g){Event.observe(g.id,"click",function(h){h.preventDefault()})})},onUpdate:function(g){Event.observe(g.id,"mousemove",function(h){$$("#"+g.id+" a").each(function(i){Event.stopObserving(i.id,"click")});Event.stopObserving(g.id,"mousemove")});var f=Sortable.serialize("admintabs");new Zikula.Ajax.Request("ajax.php?module=Admin&type=ajax&func=sortCategories",{parameters:f,onComplete:function(h){if(!h.isSuccess()){Zikula.showajaxerror(h.getMessage());return}return}});return},only:Array("admintab","active")})};make_tabs_sortable();make_modules_sortable=function(){Sortable.create("modules",{tag:"div",constraint:"",only:Array("z-adminiconcontainer"),handle:"z-dragicon",onUpdate:function(g){var f=Sortable.serialize("modules");new Zikula.Ajax.Request("ajax.php?module=Admin&type=ajax&func=sortModules",{parameters:f,onComplete:function(h){if(!h.isSuccess()){Zikula.showajaxerror(h.getMessage());return}return}});return}})};if($$("#modules div").size()>0){make_modules_sortable()}var c=$("admintabs");if(c.hasChildNodes){var a=c.getElementsByTagName("a");for(var b=0;b<a.length;b++){var e=a[b].getAttribute("id");Admin.Editor.Add(e);var d=Droppables.add(e,{accept:"draggable",hoverclass:"ajaxhover",onDrop:function(g,f){Admin.Module.Move(g.id,f.id)}})}droppables.push(d);var a=c.getElementsByTagName("span");for(var b=0;b<a.length;b++){var e=a[b].getAttribute("id");if(e!=null&&a[b].id!="addcatlink"){Admin.Context.Add(e);if($(a[b]).up("li").hasClassName("active")){continue}}}}});var Admin={};Admin.Context={};Admin.Tab={};Admin.Category={};Admin.Editor={};Admin.Module={};Admin.Context.Add=function(a){context_menu.push(new Control.ContextMenu(a,{animation:false}));context_menu[context_menu.length-1].addItem({label:lblEdit,callback:function(c){var b=c.id.match(/catcontext(\d+)/)[1];if(b){Admin.Editor.Get("C"+b).enterEditMode()}return}});context_menu[context_menu.length-1].addItem({label:lblDelete,callback:function(c){var b=c.id.match(/catcontext(\d+)/)[1];if(b){Admin.Tab.Delete(b)}return}});context_menu[context_menu.length-1].addItem({label:lblMakeDefault,callback:function(c){var b=c.id.match(/catcontext(\d+)/)[1];if(b){Admin.Tab.setDefault(b)}return}})};Admin.Editor.Add=function(d){var c=$(d);var a=c.innerHTML.length;var b=new Ajax.InPlaceEditor(d,"ajax.php?module=Admin&type=ajax&func=editCategory",{clickToEditText:lblclickToEdit,savingText:lblSaving,externalControl:"admintabs-none",externalControlOnly:true,rows:1,cols:a,submitOnBlur:true,okControl:false,cancelControl:false,ajaxOptions:Zikula.Ajax.Request.defaultOptions(),onFormCustomization:function(f,e){$(e).observe("keypress",function(g){if(g.keyCode==Event.KEY_RETURN){g.stop();g.element().blur()}})},callback:function(e,f){var g=e.id.substring(1,e.id.indexOf("-inplaceeditor"));return{catname:f,cid:g}},onComplete:function(g,e){g=Zikula.Ajax.Response.extend(g);if(!g.isSuccess()){this.element.innerHTML=Admin.Editor.getOrig(e.id);Zikula.showajaxerror(g.getMessage());return}var f=g.getData();this.element.innerHTML=f.response}});editors.push(Array(d,b,c.innerHTML))};Admin.Editor.Get=function(b){for(var a=0;a<editors.length;a++){if(editors[a][0]==b){return editors[a][1]}}};Admin.Editor.getOrig=function(b){for(var a=0;a<editors.length;a++){if(editors[a][0]==b){return editors[a][2]}}};Admin.Tab.Delete=function(b){var a={cid:b};new Zikula.Ajax.Request("ajax.php?module=Admin&type=ajax&func=deleteCategory",{parameters:a,onComplete:Admin.Tab.DeleteResponse})};Admin.Tab.DeleteResponse=function(b){if(!b.isSuccess()){Zikula.showajaxerror(b.getMessage());return}var c=b.getData();var a=$("C"+c.response);a.up("li").remove();return};Admin.Tab.setDefault=function(b){var a={cid:b};new Zikula.Ajax.Request("ajax.php?module=Admin&type=ajax&func=defaultCategory",{parameters:a,onComplete:Admin.Tab.setDefaultResponse})};Admin.Tab.setDefaultResponse=function(a){if(!a.isSuccess()){Zikula.showajaxerror(a.getMessage());return}return};Admin.Module.Move=function(c,b){var c=c.substr(7);var b=b.substr(1);var a={modid:c,cat:b};new Zikula.Ajax.Request("ajax.php?module=Admin&type=ajax&func=changeModuleCategory",{parameters:a,onComplete:Admin.Module.moveResponse})};Admin.Module.moveResponse=function(d){if(!d.isSuccess()){Zikula.showajaxerror(d.getMessage());return}var e=d.getData();$("z-admincontainer").highlight({startcolor:"#c0c0c0"});var b=$("module_"+e.response);if(e.newParentCat!=b.parentNode.id){}window["context_catcontext"+e.newParentCat].addItem({label:e.modulename,callback:function(){window.location=e.url}});var c=window["context_catcontext"+e.oldcid]["items"];for(var a in c){if(c[a].label.indexOf(e.modulename)!=-1){window["context_catcontext"+e.oldcid]["items"].splice(a,1);break}}b.parentNode.removeChild(b);return};Admin.Category.New=function(a){var c=a.parentNode;old=c.innerHTML;var b=$("ajaxNewCatHidden").innerHTML;c.innerHTML=b;c.addClassName("newCat");return false};Admin.Category.Add=function(a){var c=$("ajaxCatImage");catname=$("ajaxNewCatForm").elements.catName.value;if(catname==""){Zikula.showajaxerror(Zikula.__("You must enter a name for the new category"));Admin.Category.Cancel(c);return false}var b={catname:catname};new Zikula.Ajax.Request("ajax.php?module=Admin&type=ajax&func=addCategory",{parameters:b,onComplete:Admin.Category.addResponse});return false};Admin.Category.Cancel=function(){var a=$("addcat");a.innerHTML=old;a.removeClassName("newCat");return false};Admin.Category.addResponse=function(b){if(!b.isSuccess()){Zikula.showajaxerror(b.getMessage());Admin.Category.Cancel();return false}var c=b.getData();newcat=$("addcat");newcat.innerHTML='<a id="C'+c.response+'" href="'+c.url+'">'+catname+'</a><span id="catcontext'+c.response+'" class="z-admindrop">&nbsp;</span>';newcat.setAttribute("class","admintab");newcat.setAttribute("id","admintab_"+c.response);window["context_catcontext"+c.response]=new Control.ContextMenu("catcontext"+c.response,{leftClick:true,animation:false});var a=document.createElement("li");a.innerHTML=old;a.setAttribute("id","addcat");$("admintabs").appendChild(a);Admin.Context.Add("C"+c.response);Admin.Editor.Add("C"+c.response);Droppables.add("C"+c.response,{accept:"draggable",hoverclass:"ajaxhover",onDrop:function(e,d){Admin.Module.Move(e.id,d.id)}});Sortable.destroy("admintabs");make_tabs_sortable();return false};